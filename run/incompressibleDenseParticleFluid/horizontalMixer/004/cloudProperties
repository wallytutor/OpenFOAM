/*--------------------------------*- C++ -*----------------------------------*\
  =========                 |
  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
   \\    /   O peration     | Website:  https://openfoam.org
    \\  /    A nd           | Version:  11
     \\/     M anipulation  |
\*---------------------------------------------------------------------------*/
FoamFile
{
    format      ascii;
    class       dictionary;
    location    "constant";
    object      cloudProperties;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

type        MPPICCloud;

solution
{
    coupled                   true;
    transient                 yes;
    cellValueSourceCorrection on;
    maxCo                     0.7;

    interpolationSchemes
    {
        rho.air         cell;
        U.air           cellPoint;
        mu.air          cell;
        alpha.air       cell;
    }

    averagingMethod     dual;

    integrationSchemes
    {
        U               Euler;
    }

    sourceTerms
    {
        schemes
        {
            U           semiImplicit 1;
        }
    }
}

constantProperties
{
    rho0                2500;
}

subModels
{
    particleForces
    {
        gravity;

        sphereDrag;
    }

    injectionModels
    {
        model1
        {
            type              patchInjection;
            patchName         inlet;

            U0                (2.0 0.0 0.0);
            flowRateProfile   constant 1;
            parcelsPerSecond  7639;

            // uniformParcelSize volume;
            // massFlowRate      0.001; // = 0.1 kg/s * 0.01 m

            uniformParcelSize nParticle;
            nParticle         100;

            SOI               1.0;
            duration          1.0e+09;

            sizeDistribution
            {
                type          fixedValue;
                value         0.0001;
            }
        }
    }

    // ------------------------------------------------------------------------

    // These are MANDATORY with MPPICCloud:
    dispersionModel           none;
    stochasticCollisionModel  none;
    surfaceFilmModel          none;

    // Values = (none, explicit, implicit)
    packingModel              implicit;

    // Values = (none, relaxation)
    dampingModel              none;

    // Values = (none, stochastic)
    isotropyModel             none;

    // Calculation might start without this model, i.e. set to `none` but once
    // particles start to get injected there will be an error!
    // Values = (rebound, standardWallInteraction, localInteraction)
    patchInteractionModel     localInteraction;

    // These are not required:
    // heatTransferModel         none;
    // radiation                 off;

    // ------------------------------------------------------------------------
    // PackingModel
    // ------------------------------------------------------------------------

    explicitCoeffs
    {
        particleStressModel
        {
            type         HarrisCrighton;
            alphaPacked  0.6;
            pSolid       10.0;
            beta         2.0;
            eps          1.0e-07;
        }
        correctionLimitingMethod
        {
            type         absolute;
            e            0.9;
        }
    }

    implicitCoeffs
    {
        alphaMin         0.0001;
        rhoMin           1.0;
        applyLimiting    true;
        applyGravity     false;

        particleStressModel
        {
            type         HarrisCrighton;
            alphaPacked  0.6;
            pSolid       5.0;
            beta         2.0;
            eps          1.0e-02;
        }
    }

    // ------------------------------------------------------------------------
    // DampingModel
    // ------------------------------------------------------------------------

    relaxationCoeffs
    {
        timeScaleModel
        {
            type         nonEquilibrium;
            alphaPacked  0.6;
            e            0.9;
        }
    }

    // ------------------------------------------------------------------------
    // IsotropyModel
    // ------------------------------------------------------------------------

    stochasticCoeffs
    {
        timeScaleModel
        {
            type         isotropic;
            alphaPacked  0.6;
            e            0.9;
        }
    }

    // ------------------------------------------------------------------------
    // PatchInteractionModel
    // ------------------------------------------------------------------------

    UFactor 1.0;

    standardWallInteractionCoeffs
    {
        type        rebound; // stick, escape
        e           0.97;    // optional - elasticity coeff
        mu          0.09;    // optional - restitution coeff
    }

    localInteractionCoeffs
    {
        patches
        (
            inlet
            {
                type escape;
            }
            outlet
            {
                type escape;
            }
            walls
            {
                type rebound;
                e    0.97;
                mu   0.09;
            }
        );
    }

    // ------------------------------------------------------------------------
}

cloudFunctions
{
    massFlux1
    {
        type             massFlux;
    }
    patchPostProcessing1
    {
        type             patchPostProcessing;
        maxStoredParcels 1000;
        patches          ( outlet );
    }

    // This requires some extra settings (memory error)
    // particleTracks1
    // {
    //     type            particleTracks;
    //     trackInterval   5;
    //     maxSamples      1000000;
    //     resetOnWrite    yes;
    // }
}

// ************************************************************************* //
